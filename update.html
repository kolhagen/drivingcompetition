<!DOCTYPE html>
<html>
<head>
	<title>Driving Competition</title>

	<!-- Load Javascript Libraries -->
	<script src="build/react.js"></script>
	<script src="build/JSXTransformer.js"></script>
	<script src="build/jquery-2.1.4.min.js"></script>
	<script src="build/base64.js"></script>
	<script src="build/api.js"></script>
</head>
<body>
	<h1>Updating Scores</h1>

	<!-- Main Content Container -->
	<div id="container">Loading...</div>

	<script type="text/jsx">
		// TODO: Perform API requests and data processing here!

		// send API request
		var request = "Vehicle('sap.vean::Vehicle_AllModels')/Children?$expand=CurrentTexts,Make/CurrentTexts&$select=CurrentTexts/Name,Make/CurrentTexts/Name";
		apiRequest(request, function(data) {
			for (car of data.d.results) {
				console.log(car.Make.CurrentTexts.Name + " " + car.CurrentTexts.Name);
			}
		});

		var cars = JSON.parse(localStorage.getItem('cars'));
		if (cars !== null) {
			console.log('Found cars in cache!');
		}

		// send API request (using full url)
		var request = "https://xs01ac37c9fd2.hana.ondemand.com/sap/vean/v0.1/odata/Vehicle('sap.vean::Vehicle_AllModels')/Children?$expand=CurrentTexts,Make/CurrentTexts&$select=CurrentTexts/Name,Make/CurrentTexts/Name";
		apiRequest(request, function(data) {
			var cars = [];

			for (car of data.d.results) {
				cars.push(car.Make.CurrentTexts.Name + " " + car.CurrentTexts.Name);
			}

			// TODO: Save results to data warehouse (@Max)
			localStorage.setItem('cars', JSON.stringify(cars));
		}, true);

		// Dummy delay for indicating that process has finished (delete later)
		setTimeout(function() {
			$('#container').html('Done!');
		}, 5000);
	</script>
</body>
</html>
